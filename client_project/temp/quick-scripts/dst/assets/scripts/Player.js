
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/Player.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '6c688v72QdOKamCGCT+xaAd', 'Player');
// scripts/Player.js

"use strict";

var Global = require("common");

var wsNet = require("wsNet");

var GM = require("gm");

cc.Class({
  "extends": cc.Component,
  properties: {
    // 主角跳跃高度
    jumpHeight: 0,
    // 主角跳跃持续时间
    jumpDuration: 0,
    // 最大移动速度
    maxMoveSpeed: 0,
    // 加速度
    accel: 0,
    // 跳跃音效资源
    jumpAudio: {
      "default": null,
      type: cc.AudioClip
    },
    //
    accDirection: 0
  },
  getwsNetObj: function getwsNetObj() {
    return new wsNet();
  },
  getGMObj: function getGMObj() {
    return new GM();
  },
  setJumpAction: function setJumpAction() {
    // 跳跃上升
    var jumpUp = cc.moveBy(this.jumpDuration, cc.v2(0, this.jumpHeight)).easing(cc.easeCubicActionOut()); // 下落

    var jumpDown = cc.moveBy(this.jumpDuration, cc.v2(0, -this.jumpHeight)).easing(cc.easeCubicActionIn()); // 添加一个回调函数，用于在动作结束时调用我们定义的其他方法

    var callback = cc.callFunc(this.playJumpSound, this); // 不断重复，而且每次完成落地动作后调用回调来播放声音

    return cc.repeatForever(cc.sequence(jumpUp, jumpDown, callback));
  },
  playJumpSound: function playJumpSound() {
    // 调用声音引擎播放声音
    cc.audioEngine.playEffect(this.jumpAudio, false);
  },
  onKeyDown: function onKeyDown(event) {
    // set a flag when key pressed
    switch (event.keyCode) {
      case cc.macro.KEY.a:
        this.accLeft = true;
        break;

      case cc.macro.KEY.d:
        this.accRight = true;
        break;
    }
  },
  onKeyUp: function onKeyUp(event) {
    // unset a flag when key released
    switch (event.keyCode) {
      case cc.macro.KEY.a:
        this.accLeft = false;
        break;

      case cc.macro.KEY.d:
        this.accRight = false;
        break;
    }
  },
  onLoad: function onLoad() {
    Global.FirstLogin = null;
    Global.newStarPos = new Map(); // 加速度方向开关

    this.accLeft = false;
    this.accRight = false; // 主角当前水平方向速度

    this.xSpeed = 0; //this.xSpeed = (Math.random() - 0.5) * 2 * 10;

    this.TickFrame = 0; // 初始化键盘输入监听

    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);
    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);
  },
  checkHasUpdatedMonster: function checkHasUpdatedMonster() {
    if (Global.EnterUpdateMoster == true) {
      this.sendPlayerPos(Global.MID_SyncPos);
      Global.EnterUpdateMoster = false;
    }
  },
  onDestroy: function onDestroy() {
    // 取消键盘输入监听
    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);
    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);
  },
  sendPlayerPos: function sendPlayerPos(msgid) {
    //cc.log("send player pos: ", msgid, this.TickFrame, this.node.x, this.node.y)
    if (Global.mySessionId == null) {
      return;
    }

    var buff = new ArrayBuffer(28);
    var data = new Uint32Array(buff);
    data[0] = msgid; //消息ID

    data[1] = 5; //消息长度

    var nodexflag = 1;
    var nodex = this.node.x;

    if (nodex < 0.0) {
      nodexflag = 2;
      nodex = 0.0 - nodex;
    }

    data[2] = nodexflag; //x坐标正负

    data[3] = parseInt(nodex); //x坐标

    var nodeyflag = 1;
    var nodey = this.node.y; //-88

    if (nodey < 0.0) {
      nodeyflag = 2;
      nodey = 0.0 - nodey;
    }

    data[4] = nodeyflag; //y坐标正负

    data[5] = parseInt(nodey); //y坐标

    data[6] = Global.mySessionId;
    this.getwsNetObj().sendwsmessage(data);
  },
  checkUpdateMovePos: function checkUpdateMovePos(dt) {
    // if (!Global.syncStarPos || !Global.syncOnline4Other) {
    //     return
    // }
    if (Global.Bumped == 1) {
      //this.xSpeed = 0
      Global.Bumped = null; //移动广播所在位置，然后获取其他小球所在位置然后进行展示

      this.sendPlayerPos(Global.MID_move);
    }

    this.TickFrame += dt;

    if (this.TickFrame > 10.0) {
      //更新帧数据
      this.sendPlayerPos(Global.MID_move);
      this.TickFrame = 0;
    }
  },
  checkSpeedUpdate: function checkSpeedUpdate(dt) {
    //方向移动操作后没任何方向操作时，则慢慢减速直至停止
    if (this.accLeft == false && this.accRight == false) {
      this.xSpeed -= 0.1;

      if (this.xSpeed < 0) {
        this.xSpeed = 0;
      }
    } // 根据当前加速度方向每帧更新速度


    if (this.accLeft) {
      this.xSpeed -= this.accel * dt;
    } else if (this.accRight) {
      this.xSpeed += this.accel * dt;
    } // 限制主角的速度不能超过最大值


    if (Math.abs(this.xSpeed) > this.maxMoveSpeed) {
      // if speed reach limit, use max speed with current direction
      this.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed);
    } // 根据当前速度更新主角的位置

    /**
     * 超过边界则自动滚回场景内
     */


    if (this.node.x <= -595.0) {
      //this.xSpeed += this.accel * dt;
      this.xSpeed = 0;
      this.node.x = -595.0 + 20;
    } else if (this.node.x >= 595.0) {
      //this.xSpeed -= this.accel * dt;
      this.node.x = 595.0 - 20;
      this.xSpeed = 0;
    } else {
      this.node.x += this.xSpeed * dt;
    }
  },
  update: function update(dt) {
    //cc.log("player dt: ", this.node.x, this.node.y)
    //检查场景加载小球变化
    this.checkHasUpdatedMonster(); //检查方向移动和速度变化关系

    this.checkSpeedUpdate(dt); //检查碰撞和自身移动位置变化

    this.checkUpdateMovePos(dt); //cc.log("player pos: ", this.node.x, this.node.y)
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL1BsYXllci5qcyJdLCJuYW1lcyI6WyJHbG9iYWwiLCJyZXF1aXJlIiwid3NOZXQiLCJHTSIsImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwianVtcEhlaWdodCIsImp1bXBEdXJhdGlvbiIsIm1heE1vdmVTcGVlZCIsImFjY2VsIiwianVtcEF1ZGlvIiwidHlwZSIsIkF1ZGlvQ2xpcCIsImFjY0RpcmVjdGlvbiIsImdldHdzTmV0T2JqIiwiZ2V0R01PYmoiLCJzZXRKdW1wQWN0aW9uIiwianVtcFVwIiwibW92ZUJ5IiwidjIiLCJlYXNpbmciLCJlYXNlQ3ViaWNBY3Rpb25PdXQiLCJqdW1wRG93biIsImVhc2VDdWJpY0FjdGlvbkluIiwiY2FsbGJhY2siLCJjYWxsRnVuYyIsInBsYXlKdW1wU291bmQiLCJyZXBlYXRGb3JldmVyIiwic2VxdWVuY2UiLCJhdWRpb0VuZ2luZSIsInBsYXlFZmZlY3QiLCJvbktleURvd24iLCJldmVudCIsImtleUNvZGUiLCJtYWNybyIsIktFWSIsImEiLCJhY2NMZWZ0IiwiZCIsImFjY1JpZ2h0Iiwib25LZXlVcCIsIm9uTG9hZCIsIkZpcnN0TG9naW4iLCJuZXdTdGFyUG9zIiwiTWFwIiwieFNwZWVkIiwiVGlja0ZyYW1lIiwic3lzdGVtRXZlbnQiLCJvbiIsIlN5c3RlbUV2ZW50IiwiRXZlbnRUeXBlIiwiS0VZX0RPV04iLCJLRVlfVVAiLCJjaGVja0hhc1VwZGF0ZWRNb25zdGVyIiwiRW50ZXJVcGRhdGVNb3N0ZXIiLCJzZW5kUGxheWVyUG9zIiwiTUlEX1N5bmNQb3MiLCJvbkRlc3Ryb3kiLCJvZmYiLCJtc2dpZCIsIm15U2Vzc2lvbklkIiwiYnVmZiIsIkFycmF5QnVmZmVyIiwiZGF0YSIsIlVpbnQzMkFycmF5Iiwibm9kZXhmbGFnIiwibm9kZXgiLCJub2RlIiwieCIsInBhcnNlSW50Iiwibm9kZXlmbGFnIiwibm9kZXkiLCJ5Iiwic2VuZHdzbWVzc2FnZSIsImNoZWNrVXBkYXRlTW92ZVBvcyIsImR0IiwiQnVtcGVkIiwiTUlEX21vdmUiLCJjaGVja1NwZWVkVXBkYXRlIiwiTWF0aCIsImFicyIsInVwZGF0ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxRQUFELENBQXBCOztBQUNBLElBQUlDLEtBQUssR0FBR0QsT0FBTyxDQUFDLE9BQUQsQ0FBbkI7O0FBQ0EsSUFBSUUsRUFBRSxHQUFHRixPQUFPLENBQUMsSUFBRCxDQUFoQjs7QUFFQUcsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDTCxhQUFTRCxFQUFFLENBQUNFLFNBRFA7QUFHTEMsRUFBQUEsVUFBVSxFQUFFO0FBQ1I7QUFDQUMsSUFBQUEsVUFBVSxFQUFFLENBRko7QUFHUjtBQUNBQyxJQUFBQSxZQUFZLEVBQUUsQ0FKTjtBQUtSO0FBQ0FDLElBQUFBLFlBQVksRUFBRSxDQU5OO0FBT1I7QUFDQUMsSUFBQUEsS0FBSyxFQUFFLENBUkM7QUFTUjtBQUNBQyxJQUFBQSxTQUFTLEVBQUU7QUFDUCxpQkFBUyxJQURGO0FBRVBDLE1BQUFBLElBQUksRUFBRVQsRUFBRSxDQUFDVTtBQUZGLEtBVkg7QUFjUjtBQUNBQyxJQUFBQSxZQUFZLEVBQUU7QUFmTixHQUhQO0FBcUJMQyxFQUFBQSxXQUFXLEVBQUUsdUJBQVc7QUFDcEIsV0FBTyxJQUFJZCxLQUFKLEVBQVA7QUFDSCxHQXZCSTtBQXlCTGUsRUFBQUEsUUFBUSxFQUFFLG9CQUFXO0FBQ2pCLFdBQU8sSUFBSWQsRUFBSixFQUFQO0FBQ0gsR0EzQkk7QUE2QkxlLEVBQUFBLGFBQWEsRUFBRSx5QkFBWTtBQUN2QjtBQUNBLFFBQUlDLE1BQU0sR0FBR2YsRUFBRSxDQUFDZ0IsTUFBSCxDQUFVLEtBQUtYLFlBQWYsRUFBNkJMLEVBQUUsQ0FBQ2lCLEVBQUgsQ0FBTSxDQUFOLEVBQVMsS0FBS2IsVUFBZCxDQUE3QixFQUF3RGMsTUFBeEQsQ0FBK0RsQixFQUFFLENBQUNtQixrQkFBSCxFQUEvRCxDQUFi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QixDQUlsQjs7QUFDQSxTQUFLeUIsZ0JBQUwsQ0FBc0JILEVBQXRCLEVBTGtCLENBTWxCOztBQUNBLFNBQUtELGtCQUFMLENBQXdCQyxFQUF4QixFQVBrQixDQVFsQjtBQUNIO0FBN01JLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImxldCBHbG9iYWwgPSByZXF1aXJlKFwiY29tbW9uXCIpXG5sZXQgd3NOZXQgPSByZXF1aXJlKFwid3NOZXRcIilcbmxldCBHTSA9IHJlcXVpcmUoXCJnbVwiKVxuXG5jYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuICAgIFxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgLy8g5Li76KeS6Lez6LeD6auY5bqmXG4gICAgICAgIGp1bXBIZWlnaHQ6IDAsXG4gICAgICAgIC8vIOS4u+inkui3s+i3g+aMgee7reaXtumXtFxuICAgICAgICBqdW1wRHVyYXRpb246IDAsXG4gICAgICAgIC8vIOacgOWkp+enu+WKqOmAn+W6plxuICAgICAgICBtYXhNb3ZlU3BlZWQ6IDAsXG4gICAgICAgIC8vIOWKoOmAn+W6plxuICAgICAgICBhY2NlbDogMCxcbiAgICAgICAgLy8g6Lez6LeD6Z+z5pWI6LWE5rqQXG4gICAgICAgIGp1bXBBdWRpbzoge1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLkF1ZGlvQ2xpcFxuICAgICAgICB9LFxuICAgICAgICAvL1xuICAgICAgICBhY2NEaXJlY3Rpb246IDAsXG4gICAgfSxcblxuICAgIGdldHdzTmV0T2JqOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB3c05ldCgpO1xuICAgIH0sXG5cbiAgICBnZXRHTU9iajogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBuZXcgR00oKTtcbiAgICB9LFxuXG4gICAgc2V0SnVtcEFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyDot7Pot4PkuIrljYdcbiAgICAgICAgdmFyIGp1bXBVcCA9IGNjLm1vdmVCeSh0aGlzLmp1bXBEdXJhdGlvbiwgY2MudjIoMCwgdGhpcy5qdW1wSGVpZ2h0KSkuZWFzaW5nKGNjLmVhc2VDdWJpY0FjdGlvbk91dCgpKTtcbiAgICAgICAgLy8g5LiL6JC9XG4gICAgICAgIHZhciBqdW1wRG93biA9IGNjLm1vdmVCeSh0aGlzLmp1bXBEdXJhdGlvbiwgY2MudjIoMCwgLXRoaXMuanVtcEhlaWdodCkpLmVhc2luZyhjYy5lYXNlQ3ViaWNBY3Rpb25JbigpKTtcbiAgICAgICAgLy8g5re75Yqg5LiA5Liq5Zue6LCD5Ye95pWw77yM55So5LqO5Zyo5Yqo5L2c57uT5p2f5pe26LCD55So5oiR5Lus5a6a5LmJ55qE5YW25LuW5pa55rOVXG4gICAgICAgIHZhciBjYWxsYmFjayA9IGNjLmNhbGxGdW5jKHRoaXMucGxheUp1bXBTb3VuZCwgdGhpcyk7XG4gICAgICAgIC8vIOS4jeaWremHjeWkje+8jOiAjOS4lOavj+asoeWujOaIkOiQveWcsOWKqOS9nOWQjuiwg+eUqOWbnuiwg+adpeaSreaUvuWjsOmfs1xuICAgICAgICByZXR1cm4gY2MucmVwZWF0Rm9yZXZlcihjYy5zZXF1ZW5jZShqdW1wVXAsIGp1bXBEb3duLCBjYWxsYmFjaykpO1xuICAgIH0sXG5cbiAgICBwbGF5SnVtcFNvdW5kOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIOiwg+eUqOWjsOmfs+W8leaTjuaSreaUvuWjsOmfs1xuICAgICAgICBjYy5hdWRpb0VuZ2luZS5wbGF5RWZmZWN0KHRoaXMuanVtcEF1ZGlvLCBmYWxzZSk7XG4gICAgfSxcblxuICAgIG9uS2V5RG93biAoZXZlbnQpIHtcbiAgICAgICAgLy8gc2V0IGEgZmxhZyB3aGVuIGtleSBwcmVzc2VkXG4gICAgICAgIHN3aXRjaChldmVudC5rZXlDb2RlKSB7XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5hOlxuICAgICAgICAgICAgICAgIHRoaXMuYWNjTGVmdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5kOlxuICAgICAgICAgICAgICAgIHRoaXMuYWNjUmlnaHQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uS2V5VXAgKGV2ZW50KSB7XG4gICAgICAgIC8vIHVuc2V0IGEgZmxhZyB3aGVuIGtleSByZWxlYXNlZFxuICAgICAgICBzd2l0Y2goZXZlbnQua2V5Q29kZSkge1xuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkuYTpcbiAgICAgICAgICAgICAgICB0aGlzLmFjY0xlZnQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLmQ6XG4gICAgICAgICAgICAgICAgdGhpcy5hY2NSaWdodCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uTG9hZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIFxuICAgICAgICBHbG9iYWwuRmlyc3RMb2dpbiA9IG51bGxcbiAgICAgICAgR2xvYmFsLm5ld1N0YXJQb3MgPSBuZXcgTWFwKCk7XG5cbiAgICAgICAgLy8g5Yqg6YCf5bqm5pa55ZCR5byA5YWzXG4gICAgICAgIHRoaXMuYWNjTGVmdCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmFjY1JpZ2h0ID0gZmFsc2U7XG5cbiAgICAgICAgLy8g5Li76KeS5b2T5YmN5rC05bmz5pa55ZCR6YCf5bqmXG4gICAgICAgIHRoaXMueFNwZWVkID0gMFxuICAgICAgICAvL3RoaXMueFNwZWVkID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMiAqIDEwO1xuICAgICAgICB0aGlzLlRpY2tGcmFtZSA9IDA7XG4gICAgICAgIC8vIOWIneWni+WMlumUruebmOi+k+WFpeebkeWQrFxuICAgICAgICBjYy5zeXN0ZW1FdmVudC5vbihjYy5TeXN0ZW1FdmVudC5FdmVudFR5cGUuS0VZX0RPV04sIHRoaXMub25LZXlEb3duLCB0aGlzKTtcbiAgICAgICAgY2Muc3lzdGVtRXZlbnQub24oY2MuU3lzdGVtRXZlbnQuRXZlbnRUeXBlLktFWV9VUCwgdGhpcy5vbktleVVwLCB0aGlzKTsgIFxuICAgICAgICBcbiAgICB9LFxuXG4gICAgY2hlY2tIYXNVcGRhdGVkTW9uc3RlcjogZnVuY3Rpb24oKXtcbiAgICAgICAgaWYgKEdsb2JhbC5FbnRlclVwZGF0ZU1vc3RlciA9PSB0cnVlKSB7XG4gICAgICAgICAgICB0aGlzLnNlbmRQbGF5ZXJQb3MoR2xvYmFsLk1JRF9TeW5jUG9zKVxuICAgICAgICAgICAgR2xvYmFsLkVudGVyVXBkYXRlTW9zdGVyID0gZmFsc2VcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbkRlc3Ryb3kgKCkge1xuICAgICAgICAvLyDlj5bmtojplK7nm5jovpPlhaXnm5HlkKxcbiAgICAgICAgY2Muc3lzdGVtRXZlbnQub2ZmKGNjLlN5c3RlbUV2ZW50LkV2ZW50VHlwZS5LRVlfRE9XTiwgdGhpcy5vbktleURvd24sIHRoaXMpO1xuICAgICAgICBjYy5zeXN0ZW1FdmVudC5vZmYoY2MuU3lzdGVtRXZlbnQuRXZlbnRUeXBlLktFWV9VUCwgdGhpcy5vbktleVVwLCB0aGlzKTtcbiAgICB9LCAgICBcblxuICAgIHNlbmRQbGF5ZXJQb3M6IGZ1bmN0aW9uKG1zZ2lkKSB7XG4gICAgICAgIC8vY2MubG9nKFwic2VuZCBwbGF5ZXIgcG9zOiBcIiwgbXNnaWQsIHRoaXMuVGlja0ZyYW1lLCB0aGlzLm5vZGUueCwgdGhpcy5ub2RlLnkpXG5cbiAgICAgICAgaWYgKEdsb2JhbC5teVNlc3Npb25JZCA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBidWZmID0gbmV3IEFycmF5QnVmZmVyKDI4KVxuICAgICAgICB2YXIgZGF0YSA9IG5ldyBVaW50MzJBcnJheShidWZmKVxuXG4gICAgICAgIGRhdGFbMF0gPSBtc2dpZCAvL+a2iOaBr0lEXG4gICAgICAgIGRhdGFbMV0gPSA1IC8v5raI5oGv6ZW/5bqmXG5cbiAgICAgICAgdmFyIG5vZGV4ZmxhZyA9IDFcbiAgICAgICAgdmFyIG5vZGV4ID0gdGhpcy5ub2RlLnhcbiAgICAgICAgaWYgKG5vZGV4IDwgMC4wKSB7XG4gICAgICAgICAgICBub2RleGZsYWcgPSAyXG4gICAgICAgICAgICBub2RleCA9IDAuMCAtIG5vZGV4XG4gICAgICAgIH1cblxuICAgICAgICBkYXRhWzJdID0gbm9kZXhmbGFnICAgICAvL3jlnZDmoIfmraPotJ9cbiAgICAgICAgZGF0YVszXSA9IHBhcnNlSW50KG5vZGV4KSAvL3jlnZDmoIdcbiAgICAgICAgdmFyIG5vZGV5ZmxhZyA9IDFcbiAgICAgICAgdmFyIG5vZGV5ID0gdGhpcy5ub2RlLnkgIC8vLTg4XG4gICAgICAgIGlmIChub2RleSA8IDAuMCkge1xuICAgICAgICAgICAgbm9kZXlmbGFnID0gMlxuICAgICAgICAgICAgbm9kZXkgPSAwLjAgLSBub2RleVxuICAgICAgICB9XG5cbiAgICAgICAgZGF0YVs0XSA9IG5vZGV5ZmxhZyAgICAvL3nlnZDmoIfmraPotJ9cbiAgICAgICAgZGF0YVs1XSA9IHBhcnNlSW50KG5vZGV5KSAvL3nlnZDmoIdcbiAgICAgICAgZGF0YVs2XSA9IEdsb2JhbC5teVNlc3Npb25JZFxuXG4gICAgICAgIHRoaXMuZ2V0d3NOZXRPYmooKS5zZW5kd3NtZXNzYWdlKGRhdGEpXG4gICAgfSxcblxuICAgIGNoZWNrVXBkYXRlTW92ZVBvczogZnVuY3Rpb24oZHQpe1xuXG4gICAgICAgIC8vIGlmICghR2xvYmFsLnN5bmNTdGFyUG9zIHx8ICFHbG9iYWwuc3luY09ubGluZTRPdGhlcikge1xuICAgICAgICAvLyAgICAgcmV0dXJuXG4gICAgICAgIC8vIH1cblxuICAgICAgICBpZiAoR2xvYmFsLkJ1bXBlZCA9PSAxKXtcbiAgICAgICAgICAgIC8vdGhpcy54U3BlZWQgPSAwXG4gICAgICAgICAgICBHbG9iYWwuQnVtcGVkID0gbnVsbFxuICAgICAgICAgICAgLy/np7vliqjlub/mkq3miYDlnKjkvY3nva7vvIznhLblkI7ojrflj5blhbbku5blsI/nkIPmiYDlnKjkvY3nva7nhLblkI7ov5vooYzlsZXnpLpcbiAgICAgICAgICAgIHRoaXMuc2VuZFBsYXllclBvcyhHbG9iYWwuTUlEX21vdmUpXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLlRpY2tGcmFtZSArPSBkdFxuICAgICAgICBpZiAodGhpcy5UaWNrRnJhbWUgPiAxMC4wICl7XG4gICAgICAgICAgICAvL+abtOaWsOW4p+aVsOaNrlxuICAgICAgICAgICAgdGhpcy5zZW5kUGxheWVyUG9zKEdsb2JhbC5NSURfbW92ZSlcbiAgICAgICAgICAgIHRoaXMuVGlja0ZyYW1lID0gMFxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGNoZWNrU3BlZWRVcGRhdGU6IGZ1bmN0aW9uKGR0KXtcbiAgICAgICAgLy/mlrnlkJHnp7vliqjmk43kvZzlkI7msqHku7vkvZXmlrnlkJHmk43kvZzml7bvvIzliJnmhaLmhaLlh4/pgJ/nm7Toh7PlgZzmraJcbiAgICAgICAgaWYgKHRoaXMuYWNjTGVmdCA9PSBmYWxzZSAmJiB0aGlzLmFjY1JpZ2h0ID09IGZhbHNlKSB7XG4gICAgICAgICAgICB0aGlzLnhTcGVlZCAtPSAwLjFcbiAgICAgICAgICAgIGlmICh0aGlzLnhTcGVlZCA8IDAgKSB7XG4gICAgICAgICAgICAgICAgdGhpcy54U3BlZWQgPSAwXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyDmoLnmja7lvZPliY3liqDpgJ/luqbmlrnlkJHmr4/luKfmm7TmlrDpgJ/luqZcbiAgICAgICAgaWYgKHRoaXMuYWNjTGVmdCkge1xuICAgICAgICAgICAgdGhpcy54U3BlZWQgLT0gdGhpcy5hY2NlbCAqIGR0O1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYWNjUmlnaHQpIHtcbiAgICAgICAgICAgIHRoaXMueFNwZWVkICs9IHRoaXMuYWNjZWwgKiBkdDtcbiAgICAgICAgfVxuICAgICAgICAvLyDpmZDliLbkuLvop5LnmoTpgJ/luqbkuI3og73otoXov4fmnIDlpKflgLxcbiAgICAgICAgaWYgKCBNYXRoLmFicyh0aGlzLnhTcGVlZCkgPiB0aGlzLm1heE1vdmVTcGVlZCApIHtcbiAgICAgICAgICAgIC8vIGlmIHNwZWVkIHJlYWNoIGxpbWl0LCB1c2UgbWF4IHNwZWVkIHdpdGggY3VycmVudCBkaXJlY3Rpb25cbiAgICAgICAgICAgIHRoaXMueFNwZWVkID0gdGhpcy5tYXhNb3ZlU3BlZWQgKiB0aGlzLnhTcGVlZCAvIE1hdGguYWJzKHRoaXMueFNwZWVkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOagueaNruW9k+WJjemAn+W6puabtOaWsOS4u+inkueahOS9jee9rlxuICAgICAgICAvKipcbiAgICAgICAgICog6LaF6L+H6L6555WM5YiZ6Ieq5Yqo5rua5Zue5Zy65pmv5YaFXG4gICAgICAgICAqL1xuICAgICAgICBpZiAodGhpcy5ub2RlLnggPD0gLTU5NS4wKSB7XG4gICAgICAgICAgICAvL3RoaXMueFNwZWVkICs9IHRoaXMuYWNjZWwgKiBkdDtcbiAgICAgICAgICAgIHRoaXMueFNwZWVkID0gMFxuICAgICAgICAgICAgdGhpcy5ub2RlLnggPSAtNTk1LjAgKyAyMFxuICAgICAgICB9ZWxzZSBpZiAodGhpcy5ub2RlLnggPj0gNTk1LjApIHtcbiAgICAgICAgICAgIC8vdGhpcy54U3BlZWQgLT0gdGhpcy5hY2NlbCAqIGR0O1xuICAgICAgICAgICAgdGhpcy5ub2RlLnggPSA1OTUuMCAtIDIwXG4gICAgICAgICAgICB0aGlzLnhTcGVlZCA9IDBcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICB0aGlzLm5vZGUueCArPSB0aGlzLnhTcGVlZCAqIGR0O1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24gKGR0KSB7XG4gICAgICAgIC8vY2MubG9nKFwicGxheWVyIGR0OiBcIiwgdGhpcy5ub2RlLngsIHRoaXMubm9kZS55KVxuICAgICAgICAvL+ajgOafpeWcuuaZr+WKoOi9veWwj+eQg+WPmOWMllxuICAgICAgICB0aGlzLmNoZWNrSGFzVXBkYXRlZE1vbnN0ZXIoKVxuICAgICAgICAvL+ajgOafpeaWueWQkeenu+WKqOWSjOmAn+W6puWPmOWMluWFs+ezu1xuICAgICAgICB0aGlzLmNoZWNrU3BlZWRVcGRhdGUoZHQpXG4gICAgICAgIC8v5qOA5p+l56Kw5pKe5ZKM6Ieq6Lqr56e75Yqo5L2N572u5Y+Y5YyWXG4gICAgICAgIHRoaXMuY2hlY2tVcGRhdGVNb3ZlUG9zKGR0KVxuICAgICAgICAvL2NjLmxvZyhcInBsYXllciBwb3M6IFwiLCB0aGlzLm5vZGUueCwgdGhpcy5ub2RlLnkpXG4gICAgfSxcbn0pO1xuXG5cbiJdfQ==