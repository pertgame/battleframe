
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/login.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '85d2af0NxdLsYumGChyxxL/', 'login');
// scripts/login.js

"use strict";

var Game = require("Game");

var Global = require("common");

var wsNet = require("wsNet");

cc.Class({
  "extends": cc.Component,
  properties: {
    //注册
    registerBtn: {
      "default": null,
      type: cc.Button
    },
    //登陆
    loginBtn: {
      "default": null,
      type: cc.Button
    },
    //用户名
    nameBox: {
      "default": null,
      type: cc.EditBox
    },
    //密码
    pwdBox: {
      "default": null,
      type: cc.EditBox
    },
    //提示信息显示
    tip_info: {
      "default": null,
      type: cc.Label
    }
  },
  getGameObj: function getGameObj() {
    return new Game();
  },
  getwsNetObj: function getwsNetObj() {
    return new wsNet();
  },
  onLoad: function onLoad() {
    cc.log("login init...");
    this.getwsNetObj().swConnect();
    Global.PlayerSessionMap = new Map();
    Global.NewplayerMap = new Map();
    Global.newPlayerIds = new Array();
    Global.DelPlayerIds = new Array();
    this.registerBtn.interactable = false;
    this.loginBtn.interactable = false;
    this.registerBtn.node.on("click", this.onRegister, this);
    this.loginBtn.node.on("click", this.onLogin, this);
    this.nameBox.node.on("text-changed", this.onName, this);
    this.pwdBox.node.on("text-changed", this.onPwd, this);
  },
  // Eventobj.detail 获得组件对象
  onRegister: function onRegister(Eventobj) {
    cc.log("click register...");

    if (this.getwsNetObj().CanSendMsg()) {
      this.sendAccountMessage(Global.MID_Register);
      if (Global.FirstLogin == null) Global.FirstLogin = 1;
      Global.DoRegisterAction = 1;
    }
  },
  onLogin: function onLogin(Eventobj) {
    cc.log("click login...");

    if (this.getwsNetObj().CanSendMsg()) {
      this.sendAccountMessage(Global.MID_login);
      Global.DoLoginAction = 1;
      if (Global.FirstLogin == null) Global.FirstLogin = 1;
    }
  },
  sendAccountMessage: function sendAccountMessage(id) {
    var buffer = new ArrayBuffer(16);
    var msg = new Uint32Array(buffer);
    msg[0] = id;
    msg[1] = 2;
    msg[2] = parseInt(Global.AccountName);
    msg[3] = parseInt(Global.AccountPwd);
    this.getwsNetObj().sendwsmessage(msg);
  },
  onName: function onName(Eventobj) {
    cc.log("edit name: ", Eventobj.string);
    Global.AccountName = Eventobj.string;
    this.checkInputContent();
  },
  onPwd: function onPwd(Eventobj) {
    cc.log("edit pwd: ", Eventobj.string);
    Global.AccountPwd = Eventobj.string;
    this.checkInputContent();
  },
  //切换到主场景
  change2GameMain: function change2GameMain() {
    cc.director.loadScene('game');
  },
  //检查注册结果
  checkRegisterActionResult: function checkRegisterActionResult() {
    if (Global.DoRegisterAction == 1) {
      cc.log("RegisterSucc: ", Global.RegisterSucc);

      if (Global.RegisterSucc == 0) {
        this.tip_info.string = "用户名和密码重复或者错误";
      } else {
        this.tip_info.string = "注册成功";
      }

      Global.DoRegisterAction = 0;
    }
  },
  //检查登陆结果
  checkLoginActionResult: function checkLoginActionResult() {
    if (Global.DoLoginAction == 1 && Global.mySessionId != null) {
      //等到回复消息正常取值
      this.scheduleOnce(function () {
        cc.log("LoginSucc: ", Global.LoginSucc);

        if (Global.LoginSucc == 0) {
          this.tip_info.string = "用户名和密码重复或者错误";
        } else {
          this.tip_info.string = "登陆成功";
          cc.log("玩家登陆成功, id：", Global.mySessionId); // 切换场景

          this.change2GameMain();
        }

        Global.DoLoginAction = 0;
      }, 2);
    } else if (Global.LoginSucc == 0) {
      this.tip_info.string = "登陆失败";
      this.onLogin(null);
    }
  },
  //是否都是数字
  containDigital: function containDigital(str) {
    var reg = new RegExp("^[0-9]*$");
    return reg.test(str);
  },
  //检查输入框内容是否可用
  checkInputContent: function checkInputContent() {
    var disableShow = true;

    if (Global.AccountName == "" || Global.AccountPwd == "") {
      this.tip_info.string = "用户名或者密码不能为空！！！";
    } else if (this.containDigital(Global.AccountName) == false && this.containDigital(Global.AccountPwd) == false) {
      this.tip_info.string = "用户名或者密码不为数字！！！";
    } else if (parseInt(Global.AccountName) > Global.maxDigital || parseInt(Global.AccountPwd) > Global.maxDigital) {
      this.tip_info.string = "用户名或者密码长度超了！！！";
    } else {
      disableShow = false;
    }

    if (!disableShow) {
      this.registerBtn.interactable = true;
      this.loginBtn.interactable = true;
    }
  },
  update: function update(dt) {
    //cc.log("login update...")
    this.checkRegisterActionResult();
    this.checkLoginActionResult();
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL2xvZ2luLmpzIl0sIm5hbWVzIjpbIkdhbWUiLCJyZXF1aXJlIiwiR2xvYmFsIiwid3NOZXQiLCJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsInJlZ2lzdGVyQnRuIiwidHlwZSIsIkJ1dHRvbiIsImxvZ2luQnRuIiwibmFtZUJveCIsIkVkaXRCb3giLCJwd2RCb3giLCJ0aXBfaW5mbyIsIkxhYmVsIiwiZ2V0R2FtZU9iaiIsImdldHdzTmV0T2JqIiwib25Mb2FkIiwibG9nIiwic3dDb25uZWN0IiwiUGxheWVyU2Vzc2lvbk1hcCIsIk1hcCIsIk5ld3BsYXllck1hcCIsIm5ld1BsYXllcklkcyIsIkFycmF5IiwiRGVsUGxheWVySWRzIiwiaW50ZXJhY3RhYmxlIiwibm9kZSIsIm9uIiwib25SZWdpc3RlciIsIm9uTG9naW4iLCJvbk5hbWUiLCJvblB3ZCIsIkV2ZW50b2JqIiwiQ2FuU2VuZE1zZyIsInNlbmRBY2NvdW50TWVzc2FnZSIsIk1JRF9SZWdpc3RlciIsIkZpcnN0TG9naW4iLCJEb1JlZ2lzdGVyQWN0aW9uIiwiTUlEX2xvZ2luIiwiRG9Mb2dpbkFjdGlvbiIsImlkIiwiYnVmZmVyIiwiQXJyYXlCdWZmZXIiLCJtc2ciLCJVaW50MzJBcnJheSIsInBhcnNlSW50IiwiQWNjb3VudE5hbWUiLCJBY2NvdW50UHdkIiwic2VuZHdzbWVzc2FnZSIsInN0cmluZyIsImNoZWNrSW5wdXRDb250ZW50IiwiY2hhbmdlMkdhbWVNYWluIiwiZGlyZWN0b3IiLCJsb2FkU2NlbmUiLCJjaGVja1JlZ2lzdGVyQWN0aW9uUmVzdWx0IiwiUmVnaXN0ZXJTdWNjIiwiY2hlY2tMb2dpbkFjdGlvblJlc3VsdCIsIm15U2Vzc2lvbklkIiwic2NoZWR1bGVPbmNlIiwiTG9naW5TdWNjIiwiY29udGFpbkRpZ2l0YWwiLCJzdHIiLCJyZWciLCJSZWdFeHAiLCJ0ZXN0IiwiZGlzYWJsZVNob3ciLCJtYXhEaWdpdGFsIiwidXBkYXRl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Y0FBTCxDQUFvQjdELE1BQU0sQ0FBQytDLFdBQTNCLEtBQTJDLEtBQTNDLElBQW9ELEtBQUtjLGNBQUwsQ0FBb0I3RCxNQUFNLENBQUNnRCxVQUEzQixLQUEwQyxLQUFsRyxFQUF5RztBQUMzRyxXQUFLbkMsUUFBTCxDQUFjcUMsTUFBZCxHQUF1QixnQkFBdkI7QUFDSCxLQUZLLE1BRUEsSUFBS0osUUFBUSxDQUFDOUMsTUFBTSxDQUFDK0MsV0FBUixDQUFSLEdBQStCL0MsTUFBTSxDQUFDbUUsVUFBdkMsSUFBdURyQixRQUFRLENBQUM5QyxNQUFNLENBQUNnRCxVQUFSLENBQVIsR0FBOEJoRCxNQUFNLENBQUNtRSxVQUFoRyxFQUE2RztBQUMvRyxXQUFLdEQsUUFBTCxDQUFjcUMsTUFBZCxHQUF1QixnQkFBdkI7QUFDSCxLQUZLLE1BRUQ7QUFDRGdCLE1BQUFBLFdBQVcsR0FBRyxLQUFkO0FBQ0g7O0FBRUQsUUFBSSxDQUFDQSxXQUFMLEVBQWtCO0FBQ2QsV0FBSzVELFdBQUwsQ0FBaUJvQixZQUFqQixHQUFnQyxJQUFoQztBQUNBLFdBQUtqQixRQUFMLENBQWNpQixZQUFkLEdBQTZCLElBQTdCO0FBQ0g7QUFDSixHQXpLSTtBQTJLTDBDLEVBQUFBLE1BQU0sRUFBRSxnQkFBVUMsRUFBVixFQUFjO0FBQ2xCO0FBQ0EsU0FBS2QseUJBQUw7QUFDQSxTQUFLRSxzQkFBTDtBQUNIO0FBL0tJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImxldCBHYW1lID0gcmVxdWlyZShcIkdhbWVcIilcbmxldCBHbG9iYWwgPSByZXF1aXJlKFwiY29tbW9uXCIpXG5sZXQgd3NOZXQgPSByZXF1aXJlKFwid3NOZXRcIilcblxuY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcblxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgLy/ms6jlhoxcbiAgICAgICAgcmVnaXN0ZXJCdG46IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5CdXR0b25cbiAgICAgICAgfSxcblxuICAgICAgICAvL+eZu+mZhlxuICAgICAgICBsb2dpbkJ0bjoge1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLkJ1dHRvblxuICAgICAgICB9LFxuXG4gICAgICAgIC8v55So5oi35ZCNXG4gICAgICAgIG5hbWVCb3g6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5FZGl0Qm94XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy/lr4bnoIFcbiAgICAgICAgcHdkQm94OiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgICAgICAgdHlwZTogY2MuRWRpdEJveFxuICAgICAgICB9LFxuXG4gICAgICAgIC8v5o+Q56S65L+h5oGv5pi+56S6XG4gICAgICAgIHRpcF9pbmZvOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgICAgICAgdHlwZTogY2MuTGFiZWxcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRHYW1lT2JqOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gbmV3IEdhbWUoKTtcbiAgICB9LCAgXG5cbiAgICBnZXR3c05ldE9iajogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBuZXcgd3NOZXQoKTtcbiAgICB9LFxuXG4gICAgb25Mb2FkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgY2MubG9nKFwibG9naW4gaW5pdC4uLlwiKVxuXG4gICAgICAgIHRoaXMuZ2V0d3NOZXRPYmooKS5zd0Nvbm5lY3QoKVxuXG4gICAgICAgIEdsb2JhbC5QbGF5ZXJTZXNzaW9uTWFwID0gbmV3IE1hcCgpO1xuICAgICAgICBHbG9iYWwuTmV3cGxheWVyTWFwID0gbmV3IE1hcCgpO1xuICAgICAgICBHbG9iYWwubmV3UGxheWVySWRzID0gbmV3IEFycmF5KCk7XG4gICAgICAgIEdsb2JhbC5EZWxQbGF5ZXJJZHMgPSBuZXcgQXJyYXkoKTtcblxuICAgICAgICB0aGlzLnJlZ2lzdGVyQnRuLmludGVyYWN0YWJsZSA9IGZhbHNlXG4gICAgICAgIHRoaXMubG9naW5CdG4uaW50ZXJhY3RhYmxlID0gZmFsc2VcblxuICAgICAgICB0aGlzLnJlZ2lzdGVyQnRuLm5vZGUub24oXCJjbGlja1wiLCB0aGlzLm9uUmVnaXN0ZXIsIHRoaXMpO1xuICAgICAgICB0aGlzLmxvZ2luQnRuLm5vZGUub24oXCJjbGlja1wiLCB0aGlzLm9uTG9naW4sIHRoaXMpO1xuXG4gICAgICAgIHRoaXMubmFtZUJveC5ub2RlLm9uKFwidGV4dC1jaGFuZ2VkXCIsIHRoaXMub25OYW1lLCB0aGlzKTtcbiAgICAgICAgdGhpcy5wd2RCb3gubm9kZS5vbihcInRleHQtY2hhbmdlZFwiLCB0aGlzLm9uUHdkLCB0aGlzKTtcbiAgICB9LFxuXG4gICAgLy8gRXZlbnRvYmouZGV0YWlsIOiOt+W+l+e7hOS7tuWvueixoVxuICAgIG9uUmVnaXN0ZXI6IGZ1bmN0aW9uKEV2ZW50b2JqKXtcbiAgICAgICAgY2MubG9nKFwiY2xpY2sgcmVnaXN0ZXIuLi5cIilcbiAgICAgICAgaWYgKHRoaXMuZ2V0d3NOZXRPYmooKS5DYW5TZW5kTXNnKCkpe1xuICAgICAgICAgICAgdGhpcy5zZW5kQWNjb3VudE1lc3NhZ2UoR2xvYmFsLk1JRF9SZWdpc3RlcilcbiAgICAgICAgICAgIGlmIChHbG9iYWwuRmlyc3RMb2dpbiA9PSBudWxsIClcbiAgICAgICAgICAgICAgICBHbG9iYWwuRmlyc3RMb2dpbiA9IDFcbiAgICAgICAgICAgIEdsb2JhbC5Eb1JlZ2lzdGVyQWN0aW9uID0gMVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uTG9naW46IGZ1bmN0aW9uKEV2ZW50b2JqKXtcbiAgICAgICAgY2MubG9nKFwiY2xpY2sgbG9naW4uLi5cIilcbiAgICAgICAgaWYgKHRoaXMuZ2V0d3NOZXRPYmooKS5DYW5TZW5kTXNnKCkpe1xuICAgICAgICAgICAgdGhpcy5zZW5kQWNjb3VudE1lc3NhZ2UoR2xvYmFsLk1JRF9sb2dpbilcbiAgICAgICAgICAgIEdsb2JhbC5Eb0xvZ2luQWN0aW9uID0gMVxuICAgICAgICAgICAgaWYgKEdsb2JhbC5GaXJzdExvZ2luID09IG51bGwgKVxuICAgICAgICAgICAgICAgIEdsb2JhbC5GaXJzdExvZ2luID0gMVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNlbmRBY2NvdW50TWVzc2FnZTogZnVuY3Rpb24oaWQpe1xuICAgICAgICB2YXIgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKDE2KTtcbiAgICAgICAgdmFyIG1zZyA9IG5ldyBVaW50MzJBcnJheShidWZmZXIpO1xuICAgICAgICBtc2dbMF0gPSBpZFxuICAgICAgICBtc2dbMV0gPSAyXG4gICAgICAgIG1zZ1syXSA9IHBhcnNlSW50KEdsb2JhbC5BY2NvdW50TmFtZSlcbiAgICAgICAgbXNnWzNdID0gcGFyc2VJbnQoR2xvYmFsLkFjY291bnRQd2QpXG4gICAgICAgIHRoaXMuZ2V0d3NOZXRPYmooKS5zZW5kd3NtZXNzYWdlKG1zZylcbiAgICB9LFxuXG4gICAgb25OYW1lOiBmdW5jdGlvbihFdmVudG9iail7XG4gICAgICAgIGNjLmxvZyhcImVkaXQgbmFtZTogXCIsIEV2ZW50b2JqLnN0cmluZylcbiAgICAgICAgR2xvYmFsLkFjY291bnROYW1lID0gRXZlbnRvYmouc3RyaW5nXG4gICAgICAgIHRoaXMuY2hlY2tJbnB1dENvbnRlbnQoKVxuICAgIH0sXG5cbiAgICBvblB3ZDogZnVuY3Rpb24oRXZlbnRvYmope1xuICAgICAgICBjYy5sb2coXCJlZGl0IHB3ZDogXCIsIEV2ZW50b2JqLnN0cmluZylcbiAgICAgICAgR2xvYmFsLkFjY291bnRQd2QgPSBFdmVudG9iai5zdHJpbmdcbiAgICAgICAgdGhpcy5jaGVja0lucHV0Q29udGVudCgpXG4gICAgfSxcblxuICAgIC8v5YiH5o2i5Yiw5Li75Zy65pmvXG4gICAgY2hhbmdlMkdhbWVNYWluOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZSgnZ2FtZScpO1xuICAgIH0sXG5cbiAgICAvL+ajgOafpeazqOWGjOe7k+aenFxuICAgIGNoZWNrUmVnaXN0ZXJBY3Rpb25SZXN1bHQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgIGlmIChHbG9iYWwuRG9SZWdpc3RlckFjdGlvbiA9PSAxKSB7XG4gICAgICAgICAgICBjYy5sb2coXCJSZWdpc3RlclN1Y2M6IFwiLCBHbG9iYWwuUmVnaXN0ZXJTdWNjKVxuICAgICAgICAgICAgaWYgKEdsb2JhbC5SZWdpc3RlclN1Y2MgPT0gMCApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRpcF9pbmZvLnN0cmluZyA9IFwi55So5oi35ZCN5ZKM5a+G56CB6YeN5aSN5oiW6ICF6ZSZ6K+vXCJcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIHRoaXMudGlwX2luZm8uc3RyaW5nID0gXCLms6jlhozmiJDlip9cIlxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgR2xvYmFsLkRvUmVnaXN0ZXJBY3Rpb24gPSAwXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/mo4Dmn6XnmbvpmYbnu5PmnpxcbiAgICBjaGVja0xvZ2luQWN0aW9uUmVzdWx0OiBmdW5jdGlvbigpe1xuICAgICAgICBpZiAoR2xvYmFsLkRvTG9naW5BY3Rpb24gPT0gMSAmJiBHbG9iYWwubXlTZXNzaW9uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgLy/nrYnliLDlm57lpI3mtojmga/mraPluLjlj5blgLxcbiAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVPbmNlKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgY2MubG9nKFwiTG9naW5TdWNjOiBcIiwgR2xvYmFsLkxvZ2luU3VjYylcbiAgICAgICAgICAgICAgICBpZiAoR2xvYmFsLkxvZ2luU3VjYyA9PSAwICkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRpcF9pbmZvLnN0cmluZyA9IFwi55So5oi35ZCN5ZKM5a+G56CB6YeN5aSN5oiW6ICF6ZSZ6K+vXCJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50aXBfaW5mby5zdHJpbmcgPSBcIueZu+mZhuaIkOWKn1wiXG4gICAgICAgICAgICAgICAgICAgIGNjLmxvZyhcIueOqeWutueZu+mZhuaIkOWKnywgaWTvvJpcIiwgR2xvYmFsLm15U2Vzc2lvbklkKVxuICAgICAgICAgICAgICAgICAgICAvLyDliIfmjaLlnLrmma9cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2UyR2FtZU1haW4oKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBHbG9iYWwuRG9Mb2dpbkFjdGlvbiA9IDBcbiAgICAgICAgICAgICB9LDIpO1xuICAgICAgICB9ZWxzZSBpZiAoR2xvYmFsLkxvZ2luU3VjYyA9PSAwKXtcbiAgICAgICAgICAgIHRoaXMudGlwX2luZm8uc3RyaW5nID0gXCLnmbvpmYblpLHotKVcIlxuICAgICAgICAgICAgdGhpcy5vbkxvZ2luKG51bGwpXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/mmK/lkKbpg73mmK/mlbDlrZdcbiAgICBjb250YWluRGlnaXRhbDogZnVuY3Rpb24oc3RyKXtcbiAgICAgICAgdmFyIHJlZyA9IG5ldyBSZWdFeHAoXCJeWzAtOV0qJFwiKVxuICAgICAgICByZXR1cm4gcmVnLnRlc3Qoc3RyKVxuICAgIH0sXG5cbiAgICAvL+ajgOafpei+k+WFpeahhuWGheWuueaYr+WQpuWPr+eUqFxuICAgIGNoZWNrSW5wdXRDb250ZW50OiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgZGlzYWJsZVNob3cgPSB0cnVlXG4gICAgICAgIGlmIChHbG9iYWwuQWNjb3VudE5hbWUgPT0gXCJcIiB8fCBHbG9iYWwuQWNjb3VudFB3ZCA9PSBcIlwiKSB7XG4gICAgICAgICAgICB0aGlzLnRpcF9pbmZvLnN0cmluZyA9IFwi55So5oi35ZCN5oiW6ICF5a+G56CB5LiN6IO95Li656m677yB77yB77yBXCJcbiAgICAgICAgfWVsc2UgaWYgKHRoaXMuY29udGFpbkRpZ2l0YWwoR2xvYmFsLkFjY291bnROYW1lKSA9PSBmYWxzZSAmJiB0aGlzLmNvbnRhaW5EaWdpdGFsKEdsb2JhbC5BY2NvdW50UHdkKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgdGhpcy50aXBfaW5mby5zdHJpbmcgPSBcIueUqOaIt+WQjeaIluiAheWvhueggeS4jeS4uuaVsOWtl++8ge+8ge+8gVwiXG4gICAgICAgIH1lbHNlIGlmICgocGFyc2VJbnQoR2xvYmFsLkFjY291bnROYW1lKSA+IEdsb2JhbC5tYXhEaWdpdGFsKSB8fCAocGFyc2VJbnQoR2xvYmFsLkFjY291bnRQd2QpID4gR2xvYmFsLm1heERpZ2l0YWwpKSB7XG4gICAgICAgICAgICB0aGlzLnRpcF9pbmZvLnN0cmluZyA9IFwi55So5oi35ZCN5oiW6ICF5a+G56CB6ZW/5bqm6LaF5LqG77yB77yB77yBXCJcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBkaXNhYmxlU2hvdyA9IGZhbHNlXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWRpc2FibGVTaG93KSB7XG4gICAgICAgICAgICB0aGlzLnJlZ2lzdGVyQnRuLmludGVyYWN0YWJsZSA9IHRydWVcbiAgICAgICAgICAgIHRoaXMubG9naW5CdG4uaW50ZXJhY3RhYmxlID0gdHJ1ZVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24gKGR0KSB7XG4gICAgICAgIC8vY2MubG9nKFwibG9naW4gdXBkYXRlLi4uXCIpXG4gICAgICAgIHRoaXMuY2hlY2tSZWdpc3RlckFjdGlvblJlc3VsdCgpXG4gICAgICAgIHRoaXMuY2hlY2tMb2dpbkFjdGlvblJlc3VsdCgpXG4gICAgfVxufSkiXX0=