{"version":3,"sources":["assets/scripts/login.js"],"names":["Game","require","Global","wsNet","cc","Class","Component","properties","registerBtn","type","Button","loginBtn","nameBox","EditBox","pwdBox","tip_info","Label","getGameObj","getwsNetObj","onLoad","log","swConnect","PlayerSessionMap","Map","NewplayerMap","newPlayerIds","Array","DelPlayerIds","interactable","node","on","onRegister","onLogin","onName","onPwd","Eventobj","CanSendMsg","sendAccountMessage","MID_Register","FirstLogin","DoRegisterAction","MID_login","DoLoginAction","id","buffer","ArrayBuffer","msg","Uint32Array","parseInt","AccountName","AccountPwd","sendwsmessage","string","checkInputContent","change2GameMain","director","loadScene","checkRegisterActionResult","RegisterSucc","checkLoginActionResult","mySessionId","scheduleOnce","LoginSucc","containDigital","str","reg","RegExp","test","disableShow","maxDigital","update","dt"],"mappings":"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","sourceRoot":"/","sourcesContent":["let Game = require(\"Game\")\nlet Global = require(\"common\")\nlet wsNet = require(\"wsNet\")\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        //注册\n        registerBtn: {\n            default: null,\n            type: cc.Button\n        },\n\n        //登陆\n        loginBtn: {\n            default: null,\n            type: cc.Button\n        },\n\n        //用户名\n        nameBox: {\n            default: null,\n            type: cc.EditBox\n        },\n\n        //密码\n        pwdBox: {\n            default: null,\n            type: cc.EditBox\n        },\n\n        //提示信息显示\n        tip_info: {\n            default: null,\n            type: cc.Label\n        }\n    },\n\n    getGameObj: function(){\n        return new Game();\n    },  \n\n    getwsNetObj: function() {\n        return new wsNet();\n    },\n\n    onLoad: function() {\n        cc.log(\"login init...\")\n\n        this.getwsNetObj().swConnect()\n\n        Global.PlayerSessionMap = new Map();\n        Global.NewplayerMap = new Map();\n        Global.newPlayerIds = new Array();\n        Global.DelPlayerIds = new Array();\n\n        this.registerBtn.interactable = false\n        this.loginBtn.interactable = false\n\n        this.registerBtn.node.on(\"click\", this.onRegister, this);\n        this.loginBtn.node.on(\"click\", this.onLogin, this);\n\n        this.nameBox.node.on(\"text-changed\", this.onName, this);\n        this.pwdBox.node.on(\"text-changed\", this.onPwd, this);\n    },\n\n    // Eventobj.detail 获得组件对象\n    onRegister: function(Eventobj){\n        cc.log(\"click register...\")\n        if (this.getwsNetObj().CanSendMsg()){\n            this.sendAccountMessage(Global.MID_Register)\n            if (Global.FirstLogin == null )\n                Global.FirstLogin = 1\n            Global.DoRegisterAction = 1\n        }\n    },\n\n    onLogin: function(Eventobj){\n        cc.log(\"click login...\")\n        if (this.getwsNetObj().CanSendMsg()){\n            this.sendAccountMessage(Global.MID_login)\n            Global.DoLoginAction = 1\n            if (Global.FirstLogin == null )\n                Global.FirstLogin = 1\n        }\n    },\n\n    sendAccountMessage: function(id){\n        var buffer = new ArrayBuffer(16);\n        var msg = new Uint32Array(buffer);\n        msg[0] = id\n        msg[1] = 2\n        msg[2] = parseInt(Global.AccountName)\n        msg[3] = parseInt(Global.AccountPwd)\n        this.getwsNetObj().sendwsmessage(msg)\n    },\n\n    onName: function(Eventobj){\n        cc.log(\"edit name: \", Eventobj.string)\n        Global.AccountName = Eventobj.string\n        this.checkInputContent()\n    },\n\n    onPwd: function(Eventobj){\n        cc.log(\"edit pwd: \", Eventobj.string)\n        Global.AccountPwd = Eventobj.string\n        this.checkInputContent()\n    },\n\n    //切换到主场景\n    change2GameMain: function () {\n        cc.director.loadScene('game');\n    },\n\n    //检查注册结果\n    checkRegisterActionResult: function(){\n        if (Global.DoRegisterAction == 1) {\n            cc.log(\"RegisterSucc: \", Global.RegisterSucc)\n            if (Global.RegisterSucc == 0 ) {\n                this.tip_info.string = \"用户名和密码重复或者错误\"\n            }else{\n                this.tip_info.string = \"注册成功\"\n            }\n            Global.DoRegisterAction = 0\n        }\n    },\n\n    //检查登陆结果\n    checkLoginActionResult: function(){\n        if (Global.DoLoginAction == 1 && Global.mySessionId != null) {\n            //等到回复消息正常取值\n            this.scheduleOnce(function(){\n                cc.log(\"LoginSucc: \", Global.LoginSucc)\n                if (Global.LoginSucc == 0 ) {\n                    this.tip_info.string = \"用户名和密码重复或者错误\"\n                }else{\n                    this.tip_info.string = \"登陆成功\"\n                    cc.log(\"玩家登陆成功, id：\", Global.mySessionId)\n                    // 切换场景\n                    this.change2GameMain()\n                }\n                Global.DoLoginAction = 0\n             },2);\n        }else if (Global.LoginSucc == 0){\n            this.tip_info.string = \"登陆失败\"\n            this.onLogin(null)\n        }\n    },\n\n    //是否都是数字\n    containDigital: function(str){\n        var reg = new RegExp(\"^[0-9]*$\")\n        return reg.test(str)\n    },\n\n    //检查输入框内容是否可用\n    checkInputContent: function(){\n        var disableShow = true\n        if (Global.AccountName == \"\" || Global.AccountPwd == \"\") {\n            this.tip_info.string = \"用户名或者密码不能为空！！！\"\n        }else if (this.containDigital(Global.AccountName) == false && this.containDigital(Global.AccountPwd) == false) {\n            this.tip_info.string = \"用户名或者密码不为数字！！！\"\n        }else if ((parseInt(Global.AccountName) > Global.maxDigital) || (parseInt(Global.AccountPwd) > Global.maxDigital)) {\n            this.tip_info.string = \"用户名或者密码长度超了！！！\"\n        }else{\n            disableShow = false\n        }\n\n        if (!disableShow) {\n            this.registerBtn.interactable = true\n            this.loginBtn.interactable = true\n        }\n    },\n\n    update: function (dt) {\n        //cc.log(\"login update...\")\n        this.checkRegisterActionResult()\n        this.checkLoginActionResult()\n    }\n})"]}